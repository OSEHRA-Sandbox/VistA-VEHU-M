IBP618B ;SAB/Albany - IB*2.0*618 POST INSTALL (CONT'D);12/11/17 2:10pm
 ;;2.0;Integrated Billing;**618**;Mar 20, 1995;Build 61
 ;Per VA Directive 6402, this routine should not be modified.
 Q
 ;
UPDACT ; Update the Action Type Fields for the new Action Types
 ;
 N IBDATA,IBLOOP,IBIEN,IBACTNM
 N X,Y,DIE,DA,DR,DTOUT,DATA    ;^DIE variables
 D MES^XPDUTL("     -> Updating the Action Type Fields in file 350.1 ...")
 F IBLOOP=2:1 S IBDATA=$T(UPDDAT+IBLOOP) Q:IBDATA=" ;;END"  D
 . S IBACTNM=$P(IBDATA,";",3)   ;Name of the Action Type
 . ;Retrieve the IEN.
 . S IBIEN=$O(^IBE(350.1,"B",IBACTNM,""))
 . I IBIEN="" D MES^XPDUTL("          -> Action Type "_IBACTNM_" Is not in the Action Type file.") Q
 . ;File the update
 . S DR=".06///"_$P(IBDATA,";",4)_";"
 . S DR=DR_".07///"_$P(IBDATA,";",5)_";"
 . S DR=DR_".09///"_$P(IBDATA,";",6)
 . Q:DR=""
 . S DIE="^IBE(350.1,",DA=IBIEN
 . D ^DIE
 . K DR   ;Clear update array before next use
 D MES^XPDUTL("     -> Update completed ...")
 ;Clear the array
 Q
 ;
UPDDAT ;
 ;;Action Type;Cancellation Action;Update Action;New Action
 ;;CHOICE (INPT) CANCEL;CHOICE (INPT) CANCEL;CHOICE (INPT) UPDATE;CHOICE (INPT) NEW
 ;;CHOICE (INPT) NEW;CHOICE (INPT) CANCEL;CHOICE (INPT) UPDATE;CHOICE (INPT) NEW
 ;;CHOICE (INPT) UPDATE;CHOICE (INPT) CANCEL;CHOICE (INPT) UPDATE;CHOICE (INPT) NEW
 ;;CHOICE (PER DIEM) CANCEL;CHOICE (PER DIEM) CANCEL;CHOICE (PER DIEM) UPDATE;CHOICE (PER DIEM) NEW
 ;;CHOICE (PER DIEM) NEW;CHOICE (PER DIEM) CANCEL;CHOICE (PER DIEM) UPDATE;CHOICE (PER DIEM) NEW
 ;;CHOICE (PER DIEM) UPDATE;CHOICE (PER DIEM) CANCEL;CHOICE (PER DIEM) UPDATE;CHOICE (PER DIEM) NEW
 ;;CHOICE (OPT) CANCEL;CHOICE (OPT) CANCEL;CHOICE (OPT) UPDATE;CHOICE (OPT) NEW
 ;;CHOICE (OPT) NEW;CHOICE (OPT) CANCEL;CHOICE (OPT) UPDATE;CHOICE (OPT) NEW
 ;;CHOICE (OPT) UPDATE;CHOICE (OPT) CANCEL;CHOICE (OPT) UPDATE;CHOICE (OPT) NEW
 ;;CHOICE (RX) CANCEL;CHOICE (RX) CANCEL;CHOICE (RX) UPDATE;CHOICE (RX) NEW
 ;;CHOICE (RX) NEW;CHOICE (RX) CANCEL;CHOICE (RX) UPDATE;CHOICE (RX) NEW
 ;;CHOICE (RX) UPDATE;CHOICE (RX) CANCEL;CHOICE (RX) UPDATE;CHOICE (RX) NEW
 ;;CC (INPT) CANCEL;CC (INPT) CANCEL;CC (INPT) UPDATE;CC (INPT) NEW
 ;;CC (INPT) NEW;CC (INPT) CANCEL;CC (INPT) UPDATE;CC (INPT) NEW
 ;;CC (INPT) UPDATE;CC (INPT) CANCEL;CC (INPT) UPDATE;CC (INPT) NEW
 ;;CC (PER DIEM) CANCEL;CC (PER DIEM) CANCEL;CC (PER DIEM) UPDATE;CC (PER DIEM) NEW
 ;;CC (PER DIEM) NEW;CC (PER DIEM) CANCEL;CC (PER DIEM) UPDATE;CC (PER DIEM) NEW
 ;;CC (PER DIEM) UPDATE;CC (PER DIEM) CANCEL;CC (PER DIEM) UPDATE;CC (PER DIEM) NEW
 ;;CC (OPT) CANCEL;CC (OPT) CANCEL;CC (OPT) UPDATE;CC (OPT) NEW
 ;;CC (OPT) NEW;CC (OPT) CANCEL;CC (OPT) UPDATE;CC (OPT) NEW
 ;;CC (OPT) UPDATE;CC (OPT) CANCEL;CC (OPT) UPDATE;CC (OPT) NEW
 ;;CC (RX) CANCEL;CC (RX) CANCEL;CC (RX) UPDATE;CC (RX) NEW
 ;;CC (RX) NEW;CC (RX) CANCEL;CC (RX) UPDATE;CC (RX) NEW
 ;;CC (RX) UPDATE;CC (RX) CANCEL;CC (RX) UPDATE;CC (RX) NEW
 ;;CCN (INPT) CANCEL;CCN (INPT) CANCEL;CCN (INPT) UPDATE;CCN (INPT) NEW
 ;;CCN (INPT) NEW;CCN (INPT) CANCEL;CCN (INPT) UPDATE;CCN (INPT) NEW
 ;;CCN (INPT) UPDATE;CCN (INPT) CANCEL;CCN (INPT) UPDATE;CCN (INPT) NEW
 ;;CCN (PER DIEM) CANCEL;CCN (PER DIEM) CANCEL;CCN (PER DIEM) UPDATE;CCN (PER DIEM) NEW
 ;;CCN (PER DIEM) NEW;CCN (PER DIEM) CANCEL;CCN (PER DIEM) UPDATE;CCN (PER DIEM) NEW
 ;;CCN (PER DIEM) UPDATE;CCN (PER DIEM) CANCEL;CCN (PER DIEM) UPDATE;CCN (PER DIEM) NEW
 ;;CCN (OPT) CANCEL;CCN (OPT) CANCEL;CCN (OPT) UPDATE;CCN (OPT) NEW
 ;;CCN (OPT) NEW;CCN (OPT) CANCEL;CCN (OPT) UPDATE;CCN (OPT) NEW
 ;;CCN (OPT) UPDATE;CCN (OPT) CANCEL;CCN (OPT) UPDATE;CCN (OPT) NEW
 ;;CCN (RX) CANCEL;CCN (RX) CANCEL;CCN (RX) UPDATE;CCN (RX) NEW
 ;;CCN (RX) NEW;CCN (RX) CANCEL;CCN (RX) UPDATE;CCN (RX) NEW
 ;;CCN (RX) UPDATE;CCN (RX) CANCEL;CCN (RX) UPDATE;CCN (RX) NEW
 ;;CC MTF (INPT) CANCEL;CC MTF (INPT) CANCEL;CC MTF (INPT) UPDATE;CC MTF (INPT) NEW
 ;;CC MTF (INPT) NEW;CC MTF (INPT) CANCEL;CC MTF (INPT) UPDATE;CC MTF (INPT) NEW
 ;;CC MTF (INPT) UPDATE;CC MTF (INPT) CANCEL;CC MTF (INPT) UPDATE;CC MTF (INPT) NEW
 ;;CC MTF (PER DIEM) CANCEL;CC MTF (PER DIEM) CANCEL;CC MTF (PER DIEM) UPDATE;CC MTF (PER DIEM) NEW
 ;;CC MTF (PER DIEM) NEW;CC MTF (PER DIEM) CANCEL;CC MTF (PER DIEM) UPDATE;CC MTF (PER DIEM) NEW
 ;;CC MTF (PER DIEM) UPDATE;CC MTF (PER DIEM) CANCEL;CC MTF (PER DIEM) UPDATE;CC MTF (PER DIEM) NEW
 ;;CC MTF (OPT) CANCEL;CC MTF (OPT) CANCEL;CC MTF (OPT) UPDATE;CC MTF (OPT) NEW
 ;;CC MTF (OPT) NEW;CC MTF (OPT) CANCEL;CC MTF (OPT) UPDATE;CC MTF (OPT) NEW
 ;;CC MTF (OPT) UPDATE;CC MTF (OPT) CANCEL;CC MTF (OPT) UPDATE;CC MTF (OPT) NEW
 ;;CC MTF (RX) CANCEL;CC MTF (RX) CANCEL;CC MTF (RX) UPDATE;CC MTF (RX) NEW
 ;;CC MTF (RX) NEW;CC MTF (RX) CANCEL;CC MTF (RX) UPDATE;CC MTF (RX) NEW
 ;;CC MTF (RX) UPDATE;CC MTF (RX) CANCEL;CC MTF (RX) UPDATE;CC MTF (RX) NEW
 ;;LTC CC INPT CNH CANCEL;LTC CC INPT CNH CANCEL;LTC CC INPT CNH UPDATE;LTC CC INPT CNH NEW
 ;;LTC CC INPT CNH NEW;LTC CC INPT CNH CANCEL;LTC CC INPT CNH UPDATE;LTC CC INPT CNH NEW
 ;;LTC CC INPT CNH UPDATE;LTC CC INPT CNH CANCEL;LTC CC INPT CNH UPDATE;LTC CC INPT CNH NEW
 ;;LTC CC INPT RESPITE CANCEL;LTC CC INPT RESPITE CANCEL;LTC CC INPT RESPITE UPDATE;LTC CC INPT RESPITE NEW
 ;;LTC CC INPT RESPITE NEW;LTC CC INPT RESPITE CANCEL;LTC CC INPT RESPITE UPDATE;LTC CC INPT RESPITE NEW
 ;;LTC CC INPT RESPITE UPDATE;LTC CC INPT RESPITE CANCEL;LTC CC INPT RESPITE UPDATE;LTC CC INPT RESPITE NEW
 ;;LTC CC OPT ADHC CANCEL;LTC CC OPT ADHC CANCEL;LTC CC OPT ADHC UPDATE;LTC CC OPT ADHC NEW
 ;;LTC CC OPT ADHC NEW;LTC CC OPT ADHC CANCEL;LTC CC OPT ADHC UPDATE;LTC CC OPT ADHC NEW
 ;;LTC CC OPT ADHC UPDATE;LTC CC OPT ADHC CANCEL;LTC CC OPT ADHC UPDATE;LTC CC OPT ADHC NEW
 ;;LTC CC OPT RESPITE CANCEL;LTC CC OPT RESPITE CANCEL;LTC CC OPT RESPITE UPDATE;LTC CC OPT RESPITE NEW
 ;;LTC CC OPT RESPITE NEW;LTC CC OPT RESPITE CANCEL;LTC CC OPT RESPITE UPDATE;LTC CC OPT RESPITE NEW
 ;;LTC CC OPT RESPITE UPDATE;LTC CC OPT RESPITE CANCEL;LTC CC OPT RESPITE UPDATE;LTC CC OPT RESPITE NEW
 ;;LTC CCN INPT CNH CANCEL;LTC CCN INPT CNH CANCEL;LTC CCN INPT CNH UPDATE;LTC CCN INPT CNH NEW
 ;;LTC CCN INPT CNH NEW;LTC CCN INPT CNH CANCEL;LTC CCN INPT CNH UPDATE;LTC CCN INPT CNH NEW
 ;;LTC CCN INPT CNH UPDATE;LTC CCN INPT CNH CANCEL;LTC CCN INPT CNH UPDATE;LTC CCN INPT CNH NEW
 ;;LTC CCN INPT RESPITE CANCEL;LTC CCN INPT RESPITE CANCEL;LTC CCN INPT RESPITE UPDATE;LTC CCN INPT RESPITE NEW
 ;;LTC CCN INPT RESPITE NEW;LTC CCN INPT RESPITE CANCEL;LTC CCN INPT RESPITE UPDATE;LTC CCN INPT RESPITE NEW
 ;;LTC CCN INPT RESPITE UPDATE;LTC CCN INPT RESPITE CANCEL;LTC CCN INPT RESPITE UPDATE;LTC CCN INPT RESPITE NEW
 ;;LTC CCN OPT ADHC CANCEL;LTC CCN OPT ADHC CANCEL;LTC CCN OPT ADHC UPDATE;LTC CCN OPT ADHC NEW
 ;;LTC CCN OPT ADHC NEW;LTC CCN OPT ADHC CANCEL;LTC CCN OPT ADHC UPDATE;LTC CCN OPT ADHC NEW
 ;;LTC CCN OPT ADHC UPDATE;LTC CCN OPT ADHC CANCEL;LTC CCN OPT ADHC UPDATE;LTC CCN OPT ADHC NEW
 ;;LTC CCN OPT RESPITE CANCEL;LTC CCN OPT RESPITE CANCEL;LTC CCN OPT RESPITE UPDATE;LTC CCN OPT RESPITE NEW
 ;;LTC CCN OPT RESPITE NEW;LTC CCN OPT RESPITE CANCEL;LTC CCN OPT RESPITE UPDATE;LTC CCN OPT RESPITE NEW
 ;;LTC CCN OPT RESPITE UPDATE;LTC CCN OPT RESPITE CANCEL;LTC CCN OPT RESPITE UPDATE;LTC CCN OPT RESPITE NEW
 ;;LTC CHOICE INPT CNH CANCEL;LTC CHOICE INPT CNH CANCEL;LTC CHOICE INPT CNH UPDATE;LTC CHOICE INPT CNH NEW
 ;;LTC CHOICE INPT CNH NEW;LTC CHOICE INPT CNH CANCEL;LTC CHOICE INPT CNH UPDATE;LTC CHOICE INPT CNH NEW
 ;;LTC CHOICE INPT CNH UPDATE;LTC CHOICE INPT CNH CANCEL;LTC CHOICE INPT CNH UPDATE;LTC CHOICE INPT CNH NEW
 ;;LTC CHOICE INPT RESPITE CANCEL;LTC CHOICE INPT RESPITE CANCEL;LTC CHOICE INPT RESPITE UPDATE;LTC CHOICE INPT RESPITE NEW
 ;;LTC CHOICE INPT RESPITE NEW;LTC CHOICE INPT RESPITE CANCEL;LTC CHOICE INPT RESPITE UPDATE;LTC CHOICE INPT RESPITE NEW
 ;;LTC CHOICE INPT RESPITE UPDATE;LTC CHOICE INPT RESPITE CANCEL;LTC CHOICE INPT RESPITE UPDATE;LTC CHOICE INPT RESPITE NEW
 ;;LTC CHOICE OPT ADHC CANCEL;LTC CHOICE OPT ADHC CANCEL;LTC CHOICE OPT ADHC UPDATE;LTC CHOICE OPT ADHC NEW
 ;;LTC CHOICE OPT ADHC NEW;LTC CHOICE OPT ADHC CANCEL;LTC CHOICE OPT ADHC UPDATE;LTC CHOICE OPT ADHC NEW
 ;;LTC CHOICE OPT ADHC UPDATE;LTC CHOICE OPT ADHC CANCEL;LTC CHOICE OPT ADHC UPDATE;LTC CHOICE OPT ADHC NEW
 ;;LTC CHOICE OPT RESPITE CANCEL;LTC CHOICE OPT RESPITE CANCEL;LTC CHOICE OPT RESPITE UPDATE;LTC CHOICE OPT RESPITE NEW
 ;;LTC CHOICE OPT RESPITE NEW;LTC CHOICE OPT RESPITE CANCEL;LTC CHOICE OPT RESPITE UPDATE;LTC CHOICE OPT RESPITE NEW
 ;;LTC CHOICE OPT RESPITE UPDATE;LTC CHOICE OPT RESPITE CANCEL;LTC CHOICE OPT RESPITE UPDATE;LTC CHOICE OPT RESPITE NEW
 ;;END
 ;
ADDACTCH ; Update the Action Charges
 ;
 N IBLOOP,IBARRAY,IBACTYP,IBACTCH,IBATIEN,IBACIEN,IBEFDT,IBACTIEN,IBARYIEN,IBDATA,IBTIER,IBI,IBTRLK,IBEDT
 N X,Y,DIE,DA,DR,DTOUT,FDA,FDAIEN
 ;
 ; Define the Logic field information
 ; Set Logic
 ;
 D MES^XPDUTL("     -> Adding new ACTION CHARGE entries to file 350.2 ...")
 F IBLOOP=1:1:64 D 
 . S IBDATA=$T(ACTCHDAT+IBLOOP)
 . ;Retrieve the mapping
 . S IBACTYP=$P(IBDATA,";",3),IBACTCH=$P(IBDATA,";",4),IBTIER=$P(IBDATA,";",5)
 . ;determine if new entry for Action type/Action Charge combination
 . S IBATIEN=$O(^IBE(350.1,"B",IBACTYP,"")),IBACIEN=""
 . S:IBTIER="" IBACIEN=$O(^IBE(350.2,"B",IBACTCH,""),-1)  ;get the latest entry
 . I IBTIER'="" D
 . . ;Loading current copay schedule
 . . I IBTIER'="O" D  Q
 . . . S IBI=""
 . . . F  S IBI=$O(^IBE(350.2,"B",IBACTCH,IBI)) Q:'IBI  D  Q:IBACIEN
 . . . . S IBEDT=$$GET1^DIQ(350.2,IBI_",",.02,"I")
 . . . . Q:IBEDT'=3170227
 . . . . S IBTRLK=$$GET1^DIQ(350.2,IBI_",",.07,"E")
 . . . . I IBTRLK=IBTIER S IBACIEN=IBI
 . . ; Otherwise, loading old copay schedule.
 . . S IBTIER=2,IBI=0
 . . F  S IBI=$O(^IBE(350.2,"B",IBACTCH,IBI)) Q:'IBI  D  Q:IBACIEN
 . . . S IBEDT=$$GET1^DIQ(350.2,IBI_",",.02,"I")
 . . . Q:IBEDT'=3140312
 . . . S IBTRLK=$$GET1^DIQ(350.2,IBI_",",.07,"E")
 . . . I IBTRLK=IBTIER S IBACIEN=IBI
 . ;
 . ; Add the new entry
 . K FDA,IBARRAY  ;Clear the arrays
 . ;
 . S IBARYIEN=IBACIEN_","
 . ;Store in array for adding to the file (#350.1).
 . D GETS^DIQ(350.2,IBARYIEN,"*","I","IBARRAY")
 . S IBTIER=IBARRAY(350.2,IBARYIEN,.07,"I")
 . S FDA(350.2,"+1,",.01)=IBARRAY(350.2,IBARYIEN,.01,"I")   ;Key
 . S FDA(350.2,"+1,",.02)=IBARRAY(350.2,IBARYIEN,.02,"I")   ;Effective Date
 . S FDA(350.2,"+1,",.03)=IBATIEN                           ;Action Type
 . S FDA(350.2,"+1,",.04)=IBARRAY(350.2,IBARYIEN,.04,"I")   ;Unit Charged Fixed
 . S FDA(350.2,"+1,",.05)=IBARRAY(350.2,IBARYIEN,.05,"I")   ;Inactivation Date
 . S FDA(350.2,"+1,",.06)=IBARRAY(350.2,IBARYIEN,.06,"I")   ;Additional Amount
 . S FDA(350.2,"+1,",.07)=IBTIER                            ;CoPayment Tier
 . S FDA(350.2,"+1,",10)=IBARRAY(350.2,IBARYIEN,10,"I")     ;Unit Charge Logic
 . S FDA(350.2,"+1,",20)=IBARRAY(350.2,IBARYIEN,20,"I")     ;Additional Amount Logic
 . ;Add to the IB file.
 . D UPDATE^DIE(,"FDA","FDAIEN")
 . S FDAIEN=FDAIEN(1) K FDAIEN(1)
 D MES^XPDUTL("        New ACTION CHARGES added.")
 K FDA,IBARRAY
 Q
 ;
ACTCHDAT ; Action Charge Data
 ;;CHOICE (PER DIEM) NEW;FEE SERV INPT PER DIEM
 ;;CC (PER DIEM) NEW;FEE SERV INPT PER DIEM
 ;;CCN (PER DIEM) NEW;FEE SERV INPT PER DIEM
 ;;CC MTF (PER DIEM) NEW;FEE SERV INPT PER DIEM
 ;;LTC CC INPT CNH NEW;FEE LTC INPT CNH
 ;;LTC CCN INPT CNH NEW;FEE LTC INPT CNH
 ;;LTC CHOICE INPT CNH NEW;FEE LTC INPT CNH
 ;;LTC CC INPT RESPITE NEW;FEE LTC INPT RESPITE
 ;;LTC CCN INPT RESPITE NEW;FEE LTC INPT RESPITE
 ;;LTC CHOICE INPT RESPITE NEW;FEE LTC INPT RESPITE
 ;;LTC CC OPT ADHC NEW;FEE LTC OPT ADHC
 ;;LTC CCN OPT ADHC NEW;FEE LTC OPT ADHC
 ;;LTC CHOICE OPT ADHC NEW;FEE LTC OPT ADHC
 ;;LTC CC OPT RESPITE NEW;FEE LTC OPT RESPITE
 ;;LTC CCN OPT RESPITE NEW;FEE LTC OPT RESPITE
 ;;LTC CHOICE OPT RESPITE NEW;FEE LTC OPT RESPITE
 ;;CHOICE (RX) NEW;FEE SERV RX1;O
 ;;CHOICE (RX) CANCEL;FEE SERV RX3;O
 ;;CHOICE (RX) UPDATE;FEE SERV RX4;O
 ;;CC (RX) NEW;FEE SERV RX1;O
 ;;CC (RX) CANCEL;FEE SERV RX3;O
 ;;CC (RX) UPDATE;FEE SERV RX4;O
 ;;CCN (RX) NEW;FEE SERV RX1;O
 ;;CCN (RX) CANCEL;FEE SERV RX3;O
 ;;CCN (RX) UPDATE;FEE SERV RX4;O
 ;;CC MTF (RX) NEW;FEE SERV RX1;O
 ;;CC MTF (RX) CANCEL;FEE SERV RX3;O
 ;;CC MTF (RX) UPDATE;FEE SERV RX4;O
 ;;CHOICE (RX) NEW;FEE SERV RX1;1
 ;;CHOICE (RX) NEW;FEE SERV RX1;2
 ;;CHOICE (RX) NEW;FEE SERV RX1;3
 ;;CHOICE (RX) CANCEL;FEE SERV RX3;1
 ;;CHOICE (RX) CANCEL;FEE SERV RX3;2
 ;;CHOICE (RX) CANCEL;FEE SERV RX3;3
 ;;CHOICE (RX) UPDATE;FEE SERV RX4;1
 ;;CHOICE (RX) UPDATE;FEE SERV RX4;2
 ;;CHOICE (RX) UPDATE;FEE SERV RX4;3
 ;;CC (RX) NEW;FEE SERV RX1;1
 ;;CC (RX) NEW;FEE SERV RX1;2
 ;;CC (RX) NEW;FEE SERV RX1;3
 ;;CC (RX) CANCEL;FEE SERV RX3;1
 ;;CC (RX) CANCEL;FEE SERV RX3;2
 ;;CC (RX) CANCEL;FEE SERV RX3;3
 ;;CC (RX) UPDATE;FEE SERV RX4;1
 ;;CC (RX) UPDATE;FEE SERV RX4;2
 ;;CC (RX) UPDATE;FEE SERV RX4;3
 ;;CCN (RX) NEW;FEE SERV RX1;1
 ;;CCN (RX) NEW;FEE SERV RX1;2
 ;;CCN (RX) NEW;FEE SERV RX1;3
 ;;CCN (RX) CANCEL;FEE SERV RX3;1
 ;;CCN (RX) CANCEL;FEE SERV RX3;2
 ;;CCN (RX) CANCEL;FEE SERV RX3;3
 ;;CCN (RX) UPDATE;FEE SERV RX4;1
 ;;CCN (RX) UPDATE;FEE SERV RX4;2
 ;;CCN (RX) UPDATE;FEE SERV RX4;3
 ;;CC MTF (RX) NEW;FEE SERV RX1;1
 ;;CC MTF (RX) NEW;FEE SERV RX1;2
 ;;CC MTF (RX) NEW;FEE SERV RX1;3
 ;;CC MTF (RX) CANCEL;FEE SERV RX3;1
 ;;CC MTF (RX) CANCEL;FEE SERV RX3;2
 ;;CC MTF (RX) CANCEL;FEE SERV RX3;3
 ;;CC MTF (RX) UPDATE;FEE SERV RX4;1
 ;;CC MTF (RX) UPDATE;FEE SERV RX4;2
 ;;CC MTF (RX) UPDATE;FEE SERV RX4;3
 Q
