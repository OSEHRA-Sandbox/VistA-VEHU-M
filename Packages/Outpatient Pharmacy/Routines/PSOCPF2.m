PSOCPF2 ;BIR/BAA - Pharmacy CO-PAY Application Utilities for IB ;02/06/92
 ;;7.0;OUTPATIENT PHARMACY;**463**;DEC 1997;Build 36
 ;
 Q
 ;^TMP($J,"PSOCPFX",VCNT)=NAME_U_DFN_U_MED_U_RIEN_U_BLN_U_PRIEN_U_RFL_U_RX_U_DEBTOR
 ;
PATACP ; ACTION - Account Profile (AP)
 D FULL^VALM1
 D EN^VALM2($G(XQORNOD(0)))
 D CLEAR^VALM1
 I $D(VALMY),$D(^TMP($J,"PSOCPF")) D
 . S IBXX=0 F  S IBXX=$O(VALMY(IBXX)) Q:'IBXX  D
 .. N RCDEBTDA
 .. S RC=$G(^TMP($J,"PSOCPFX",IBXX))
 .. S RCDEBTDA=$P(RC,U,9)  ;Need DEBTOR for AP
 .. I 'RCDEBTDA D  Q
 ... W !!,"There is no Bill associated with this entry."
 ... D PAUSE^VALM1
 .. D EN^VALM("RCDP ACCOUNT PROFILE")
 D BLD^PSOCPF
 S VALMBCK="R"
 Q
 ;
BILPRO ; view BILL PROFILE
 D FULL^VALM1
 N I,J,IBXX,VALMY,ECNT,REC,RCBILLDA
 D EN^VALM2($G(XQORNOD(0)))
 I $D(VALMY),$D(^TMP($J,"PSOCPF")) D
 . S IBXX=0 F  S IBXX=$O(VALMY(IBXX)) Q:'IBXX  D
 .. S REC=$G(^TMP($J,"PSOCPFX",IBXX))
 .. S RCBILLDA=$P(REC,U,6)
 .. I RCBILLDA="" D  Q
 ... W !!,"There is no Bill associated with this entry."
 ... D PAUSE^VALM1
 .. D EN^VALM("RCDP BILL PROFILE")
 D BLD^PSOCPF
 S VALMBCK="R"
 Q
 ;
TPJI ; view THIRD PARTY JOIN INQUIRY
 D FULL^VALM1
 N I,J,IBXX,VALMY,ECNT,DFN,GOPAT,REC
 D EN^VALM2($G(XQORNOD(0)))
 I $D(VALMY),$D(^TMP($J,"PSOCPF")) D
 . S IBXX=0 F  S IBXX=$O(VALMY(IBXX)) Q:'IBXX  D
 .. S REC=$G(^TMP($J,"PSOCPFX",IBXX))
 .. S DFN=$P(REC,U,2)
 .. D EN^VALM("IBJT ACTIVE LIST")
 D BLD^PSOCPF
 S VALMBCK="R"
 Q
 ;
BILINQ ; view PATIENT BILLING INQUIRY
 D FULL^VALM1
 N I,J,IBXX,VALMY,ECNT,DFN,GOPAT,IBIL,REC,IBFULL,IBIFN
 D EN^VALM2($G(XQORNOD(0)))
 I $D(VALMY),$D(^TMP($J,"PSOCPF")) D
 . S IBXX=0 F  S IBXX=$O(VALMY(IBXX)) Q:'IBXX  D
 .. S REC=$G(^TMP($J,"PSOCPFX",IBXX))
 .. S IBIL=$P(REC,U,5),IBFULL=1,IBIFN=""
 .. I IBIL="" D  Q
 ... W !!,"There is no Bill associated with this entry."
 ... D PAUSE^VALM1
 .. D EN^IBOLK
 D BLD^PSOCPF
 S VALMBCK="R"
 Q
 ;
PATINQ ; view PATIENT INQUIRY
 D FULL^VALM1
 N I,J,IBXX,VALMY,ECNT,DFN,GOPAT,REC
 D EN^VALM2($G(XQORNOD(0)))
 I $D(VALMY),$D(^TMP($J,"PSOCPF")) D
 . S IBXX=0 F  S IBXX=$O(VALMY(IBXX)) Q:'IBXX  D
 .. S REC=$G(^TMP($J,"PSOCPFX",IBXX))
 .. S DFN=$P(REC,U,2)
 .. D EN^DGRPD
 D BLD^PSOCPF
 S VALMBCK="R"
 Q
 ;
NP ; -- change patient,date and prescriptions.
 N VALMQUIT,IBDFN,PAT,DFN,SDATE,TDATE,IBDATES,SAVFIL
 D FULL^VALM1
 I $D(^TMP($J,"PSOCPFF",0)) S FILTERS(0)=^TMP($J,"PSOCPFF",0),SAVFIL(0)=FILTERS(0)
 S R=""
 F  S R=$O(^TMP($J,"PSOCPFF",1,R)) Q:R=""  S SAVFIL(1,R)=^TMP($J,"PSOCPFF",1,R)
 ;
 K ^TMP($J,"PSOCPFF")
 S IBDFN=$P(FILTERS(0),U,4)
 S PAT=$$ONEPAT^PSOCPF()
 I PAT=-1 D RESET S VALMBCK="R" G NPQ
 S (DFN,$P(FILTERS(0),U,4))=+PAT
 S SDATE=$P(FILTERS(0),U,1)
 S TDATE=$P(FILTERS(0),U,2)
 S IBDATES="Fill Dates",IBDATES=$$FMDATES^PSOCPF(IBDATES,SDATE,TDATE)
 I $D(VALMQUIT) D RESET S VALMBCK="R" G NPQ
 D ADDRX^PSOCPF
 S $P(FILTERS(0),U,1)=$P(IBDATES,U,1),$P(FILTERS(0),U,2)=$P(IBDATES,U,2)
 S ^TMP($J,"PSOCPF")=FILTERS(0)
 S R=""
 F  S R=$O(FILTERS(1,R)) Q:R=""  S ^TMP($J,"PSOCPFF",1,R)=FILTERS(1,R)
 W !,"Please be patient while I gather the requested data.",!
 S VALMBG=1 D SORT^PSOCPF1,HDR^PSOCPF,BLD^PSOCPF
 S VALMBCK="R"
NPQ Q
 ;
 ;
RESET ; Reset filters to current patient
 S (DFN,$P(FILTERS(0),U,4))=IBDFN
 S FILTERS(0)=SAVFIL(0)
 S BDATE=$P(FILTERS(0),U,1),EDATE=$P(FILTERS(0),U,2)
 S RXS=$P(FILTERS(0),U,3),PAT=$P(FILTERS(0),U,4)
 S ^TMP($J,"PSOCPFF",0)=FILTERS(0)
 S R=""
 F  S R=$O(SAVFIL(1,R)) Q:R=""  S (FILTERS(1,R),^TMP($J,"PSOCPFF",1,R))=SAVFIL(1,R)
 Q
